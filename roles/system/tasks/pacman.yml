- blockinfile:
    path: /etc/pacman.conf
    block: |
      [archlinuxfr]
      SigLevel = Never
      Server = http://repo.archlinux.fr/$arch
      [multilib]
      Include = /etc/pacman.d/mirrorlist
    marker: "# {mark} Ansible managed block"
  register: add_archlinuxfr_source
  become: yes

- package:
    update_cache: yes
  when: add_archlinuxfr_source.changed
  become: yes

- name: configure makepkg
  lineinfile:
    path: /etc/makepkg.conf
    regexp: "{{Â item.regexp }}"
    line: "{{ item.line }}"
  with_items:
  - { regexp: "^#?MAKEFLAGS=", line: 'MAKEFLAGS="-j8"' }
  - { regexp: "^#?PKGEXT=", line: "PKGEXT='.pkg.tar'" }
  become: yes
